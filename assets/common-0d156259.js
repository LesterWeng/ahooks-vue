import{b as n,L as e,i as r,e as t,g as a,j as o,u as l,A as i,f as u}from"./common-469a5f66.js";import"./common-ee3276ba.js";import{u as s}from"./common-8627e519.js";import{d}from"./common-a22be914.js";import{t as c}from"./common-2f9a21e0.js";const m={formatResult:n=>n,requestMethod:function(n){let e,r;return"string"==typeof n?e=n:(e=n.url,r=n),fetch(e,r).then((n=>{if(n.ok)return n.json();throw new Error(n.statusText)}))},manual:!1,onSuccess:()=>{},onError:()=>{},defaultLoading:!1,loadingDelay:0,pollingInterval:0,pollingWhenHidden:!0,pollingSinceLastFinished:!0,defaultParams:[],debounceInterval:0,loadingWhenDebounceStart:!0,throttleInterval:0,initialData:void 0,throwOnError:!1},g=Symbol("useRequestConfig");function f(a,o={}){let l={};e()&&(l=r(g)??{});const i={...m,...l,...o},{requestMethod:u,defaultLoading:f,manual:v,throwOnError:p,onSuccess:h,onError:b,formatResult:y,initialData:I,defaultParams:D,loadingDelay:T,debounceInterval:w,loadingWhenDebounceStart:j,throttleInterval:P,pollingInterval:S,pollingWhenHidden:W,pollingSinceLastFinished:k}=i;let C;C=["string","object"].includes(typeof a)?()=>u(a):(...n)=>new Promise(((e,r)=>{const t=a(...n);let o=t;if(!t.then){if(!["string","object"].includes(typeof t))throw new Error("If sevice is a function, it must return a String, Object or Promise");o=u(t)}o.then(e).catch(r)}));const E=n(f),L=n(I),N=n(),U=n(D),x=n(D);let q=0,A=!1;e()&&t((()=>{A=!0}));let H,M,O=n(!0);function R(...n){M&&clearTimeout(M),H&&clearTimeout(H),T?H=setTimeout((()=>{E.value=!0}),T):E.value=!0,q++;const e=q;U.value=n;const r=()=>A||e!==q;return C(...n).then((e=>{if(r())return;const t=y(e);return L.value=t,x.value=n,h(t,n),t})).catch((e=>{if(!r()&&(console.error(e),N.value=e,b(e,n),p))throw e})).finally((()=>{if(!r()){if(H&&clearTimeout(H),S&&k){if(W&&!O.value)return;M=setTimeout((()=>{R(...n)}),S)}E.value=!1}}))}e()&&(O=s().isVisible);let F,V=R;if(w){const n=d(R,w);V=(...e)=>(j&&(E.value=!0),Promise.resolve(n(...e)))}if(P){const n=c(R,P);V=(...e)=>Promise.resolve(n(...e))}return S&&!k&&(V=(...n)=>(F&&clearInterval(F),F=setInterval((()=>{W&&!O.value||R(...n)}),S),R(...n))),v||V(...D),{loading:E,error:N,data:L,run:V,params:U,lastSuccessParams:x,cancel:()=>{F&&clearInterval(F),M&&clearTimeout(M),H&&clearTimeout(H),q++,E.value=!1},refresh:function(){return V(...U.value)}}}function v(n,e){return new Promise(((r,t)=>{setTimeout((()=>{e?t("something error"):r(n?"T-"+n:"yexiu")}),1e3)}))}let p=0;function h(){return new Promise((n=>{setTimeout((()=>{n(p++)}),500)}))}var b={setup(){const{loading:n,run:e,data:r}=f(h,{}),{loading:t,run:a,data:o}=f(h,{loadingDelay:800});return{loading:n,data:r,loadingWithDelay:t,dataWithDelay:o,runAll:()=>{e(),a()}}}};const y=i(" normal: "),I=i(" loadingDelay: ");b.render=function(n,e,r,t,i,s){return u(),a("div",null,[o("p",null,[y,o("span",null,l(t.loading?"loading":t.data),1)]),o("p",null,[I,o("span",null,l(t.loadingWithDelay?"loading":t.dataWithDelay),1)]),o("button",{onClick:e[1]||(e[1]=(...n)=>t.runAll(...n))},"run")])};var D={setup(){const{data:n,loading:e,error:r,run:t}=f(h,{manual:!0,throttleInterval:500});return{data:n,loading:e,error:r,run:t}}};const T=i(" UserName: ");D.render=function(n,e,r,t,i,s){return u(),a("div",null,[o("p",null,[T,o("span",null,l(t.loading?"loading":t.data),1)]),o("button",{onClick:e[1]||(e[1]=n=>t.run())},"run")])};var w={setup(){const{data:n,loading:e,error:r,run:t}=f(h,{manual:!0,debounceInterval:1e3});return{data:n,loading:e,error:r,run:t}}};const j=i(" UserName: ");w.render=function(n,e,r,t,i,s){return u(),a("div",null,[o("p",null,[j,o("span",null,l(t.loading?"loading":t.data),1)]),o("button",{onClick:e[1]||(e[1]=n=>t.run())},"run")])};var P={setup(){const{data:n,loading:e,error:r,run:t,cancel:a}=f(v,{pollingInterval:1e3,pollingWhenHidden:!0});return{data:n,loading:e,error:r,run:t,cancel:a}}};const S=i(" UserName: ");P.render=function(n,e,r,t,i,s){return u(),a("div",null,[o("p",null,[S,o("span",null,l(t.loading?"loading":t.data),1)]),o("button",{onClick:e[1]||(e[1]=n=>t.run()),style:{"margin-right":"8px"}},"run"),o("button",{onClick:e[2]||(e[2]=(...n)=>t.cancel(...n))},"cancel")])};var W={setup(){const{data:n,loading:e,error:r,run:t}=f(v,{manual:!0});return{data:n,loading:e,error:r,run:t}}};const k=i(" UserName: ");function C(){return new Promise((n=>{setTimeout((()=>{n(Math.random().toString(36).slice(2))}),1500)}))}W.render=function(n,e,r,t,i,s){return u(),a("div",null,[o("p",null,[k,o("span",null,l(t.loading?"loading":t.data),1)]),o("button",{onClick:e[1]||(e[1]=n=>t.run())},"run")])};var E={setup(){const{data:n,error:e,loading:r}=f(C);return{data:n,error:e,loading:r}}};const L=i(" UserName: ");E.render=function(n,e,r,t,i,s){return u(),a("div",null,[L,o("span",null,l(t.loading?"loading":t.data),1)])};export{W as a,P as b,w as c,D as d,b as e,E as s};
