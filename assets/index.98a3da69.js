var e=Object.assign;import{l as t}from"./axios.b3cfc440.js";import{u as r}from"./index.4af6efd2.js";import{L as n,i as o,u as a,H as l,z as i}from"./framework.8cd85e4b.js";const s={formatResult:e=>e,requestMethod:function(e){let t,r;return"string"==typeof e?t=e:(t=e.url,r=e),fetch(t,r).then((e=>{if(e.ok)return e.json();throw new Error(e.statusText)}))},manual:!1,onSuccess:()=>{},onError:()=>{},onFinally:()=>{},defaultLoading:!1,loadingDelay:0,pollingInterval:0,pollingWhenHidden:!0,pollingSinceLastFinished:!0,defaultParams:[],debounceInterval:0,loadingWhenDebounceStart:!0,throttleInterval:0,initialData:void 0,throwOnError:!1,refreshDeps:[],refreshOnWindowFocus:!1},u=Symbol("useRequestConfig");function c(c,f={}){var d;let v={};n()&&(v=null!=(d=o(u))?d:{});const h=e(e(e({},s),v),f),{requestMethod:m,defaultLoading:g,manual:p,throwOnError:b,onSuccess:I,onError:w,onFinally:D,formatResult:y,initialData:S,defaultParams:j,loadingDelay:T,debounceInterval:P,loadingWhenDebounceStart:E,throttleInterval:F,pollingInterval:O,pollingWhenHidden:W,pollingSinceLastFinished:L,refreshOnWindowFocus:x,refreshDeps:q}=h;let H;H=["string","object"].includes(typeof c)?()=>m(c):(...e)=>new Promise(((t,r)=>{const n=c(...e);let o=n;if(!n.then){if(!["string","object"].includes(typeof n))throw new Error("If sevice is a function, it must return a String, Object or Promise");o=m(n)}o.then(t).catch(r)}));const R=a(g),k=a(S),M=a(),V=a(j),z=a(j);let C=0,A=!1;n()&&l((()=>{A=!0}));let B,G,J=a(!0);function K(...e){G&&clearTimeout(G),B&&clearTimeout(B),T?B=setTimeout((()=>{R.value=!0}),T):R.value=!0,C++;const r=C;V.value=t.cloneDeep(e);const n=()=>A||r!==C;return H(...e).then((r=>{if(n())return;const o=y(r);return k.value=o,z.value=t.cloneDeep(e),I(o,e),o})).catch((t=>{if(!n()&&(console.error(t),M.value=t,w(t,e),b))throw t})).finally((()=>{n()||(B&&clearTimeout(B),O&&L&&(G=W&&!J.value?setInterval((()=>{W&&!J.value||(clearInterval(G),K(...e))}),O):setTimeout((()=>{K(...e)}),O)),R.value=!1,D())}))}n()&&(J=r({onVisible(){x&&U()}}).isVisible);let N,Q=K;if(P){const e=t.debounce(K,P);Q=(...t)=>(E&&(R.value=!0),Promise.resolve(e(...t)))}if(F){const e=t.throttle(K,F);Q=(...t)=>Promise.resolve(e(...t))}function U(){return Q(...V.value)}return O&&!L&&(Q=(...e)=>(N&&clearInterval(N),N=setInterval((()=>{W&&!J.value||K(...e)}),O),K(...e))),p||Q(...j),i(q,U),{loading:R,error:M,data:k,run:Q,params:V,lastSuccessParams:z,cancel:()=>{N&&clearInterval(N),G&&clearTimeout(G),B&&clearTimeout(B),C++,R.value=!1},refresh:U}}export{c as u};
