import{e as n,N as e,i as r,c as a,f as t,g as o,j as l,t as i,E as u}from"./common-95e9c5a8.js";import"./common-9c4a6e55.js";import{u as s}from"./common-a1b7487a.js";import{d}from"./common-a22be914.js";import{t as c}from"./common-2f9a21e0.js";const m={formatResult:n=>n,requestMethod:function(n){let e,r;return"string"==typeof n?e=n:(e=n.url,r=n),fetch(e,r).then((n=>{if(n.ok)return n.json();throw new Error(n.statusText)}))},manual:!1,onSuccess:()=>{},onError:()=>{},defaultLoading:!1,loadingDelay:0,pollingInterval:0,pollingWhenHidden:!0,pollingSinceLastFinished:!0,defaultParams:[],debounceInterval:0,loadingWhenDebounceStart:!0,throttleInterval:0,initialData:void 0,throwOnError:!1,paginated:!1},g=Symbol("useRequestConfig");function f(t,o={}){let l={};e()&&(l=r(g)??{});const i={...m,...l,...o},{requestMethod:u,defaultLoading:f,manual:v,throwOnError:p,onSuccess:h,onError:b,formatResult:y,initialData:I,defaultParams:D,loadingDelay:T,debounceInterval:w,loadingWhenDebounceStart:j,throttleInterval:P,pollingInterval:S,pollingWhenHidden:W,pollingSinceLastFinished:k}=i;let C;C=["string","object"].includes(typeof t)?()=>u(t):(...n)=>new Promise(((e,r)=>{const a=t(...n);let o=a;if(!a.then){if(!["string","object"].includes(typeof a))throw new Error("If sevice is a function, it must return a String, Object or Promise");o=u(a)}o.then(e).catch(r)}));const E=n(f),N=n(I),U=n(),x=n(D),L=n(D);let q=0,H=!1;e()&&a((()=>{H=!0}));let M,O,R=n(!0);function A(...n){O&&clearTimeout(O),M&&clearTimeout(M),T?M=setTimeout((()=>{E.value=!0}),T):E.value=!0,q++;const e=q;x.value=n;const r=()=>H||e!==q;return C(...n).then((e=>{if(r())return;const a=y(e);return N.value=a,L.value=n,h(a,n),a})).catch((e=>{if(!r()&&(console.error(e),U.value=e,b(e,n),p))throw e})).finally((()=>{if(!r()){if(M&&clearTimeout(M),S&&k){if(W&&!R.value)return;O=setTimeout((()=>{A(...n)}),S)}E.value=!1}}))}e()&&(R=s().isVisible);let F,V=A;if(w){const n=d(A,w);V=(...e)=>(j&&(E.value=!0),Promise.resolve(n(...e)))}if(P){const n=c(A,P);V=(...e)=>Promise.resolve(n(...e))}return S&&!k&&(V=(...n)=>(F&&clearInterval(F),F=setInterval((()=>{W&&!R.value||A(...n)}),S),A(...n))),v||V(...D),{loading:E,error:U,data:N,run:V,params:x,lastSuccessParams:L,cancel:()=>{F&&clearInterval(F),O&&clearTimeout(O),M&&clearTimeout(M),q++,E.value=!1},refresh:function(){return V(...x.value)}}}function v(n,e){return new Promise(((r,a)=>{setTimeout((()=>{e?a("something error"):r(n?`T-${n}`:"yexiu")}),1e3)}))}let p=0;function h(){return new Promise((n=>{setTimeout((()=>{n(p++)}),500)}))}var b={setup(){const{loading:n,run:e,data:r}=f(h,{}),{loading:a,run:t,data:o}=f(h,{loadingDelay:800});return{loading:n,data:r,loadingWithDelay:a,dataWithDelay:o,runAll:()=>{e(),t()}}}};const y=u(" normal: "),I=u(" loadingDelay: ");b.render=function(n,e,r,a,u,s){return t(),o("div",null,[l("p",null,[y,l("span",null,i(a.loading?"loading":a.data),1)]),l("p",null,[I,l("span",null,i(a.loadingWithDelay?"loading":a.dataWithDelay),1)]),l("button",{onClick:e[1]||(e[1]=(...n)=>a.runAll(...n))},"run")])};var D={setup(){const{data:n,loading:e,error:r,run:a}=f(h,{manual:!0,throttleInterval:500});return{data:n,loading:e,error:r,run:a}}};const T=u(" UserName: ");D.render=function(n,e,r,a,u,s){return t(),o("div",null,[l("p",null,[T,l("span",null,i(a.loading?"loading":a.data),1)]),l("button",{onClick:e[1]||(e[1]=n=>a.run())},"run")])};var w={setup(){const{data:n,loading:e,error:r,run:a}=f(h,{manual:!0,debounceInterval:1e3});return{data:n,loading:e,error:r,run:a}}};const j=u(" UserName: ");w.render=function(n,e,r,a,u,s){return t(),o("div",null,[l("p",null,[j,l("span",null,i(a.loading?"loading":a.data),1)]),l("button",{onClick:e[1]||(e[1]=n=>a.run())},"run")])};var P={setup(){const{data:n,loading:e,error:r,run:a,cancel:t}=f(v,{pollingInterval:1e3,pollingWhenHidden:!0});return{data:n,loading:e,error:r,run:a,cancel:t}}};const S=u(" UserName: ");P.render=function(n,e,r,a,u,s){return t(),o("div",null,[l("p",null,[S,l("span",null,i(a.loading?"loading":a.data),1)]),l("button",{onClick:e[1]||(e[1]=n=>a.run()),style:{"margin-right":"8px"}},"run"),l("button",{onClick:e[2]||(e[2]=(...n)=>a.cancel(...n))},"cancel")])};var W={setup(){const{data:n,loading:e,error:r,run:a}=f(v,{manual:!0});return{data:n,loading:e,error:r,run:a}}};const k=u(" UserName: ");function C(){return new Promise((n=>{setTimeout((()=>{n(Math.random().toString(36).slice(2))}),1500)}))}W.render=function(n,e,r,a,u,s){return t(),o("div",null,[l("p",null,[k,l("span",null,i(a.loading?"loading":a.data),1)]),l("button",{onClick:e[1]||(e[1]=n=>a.run())},"run")])};var E={setup(){const{data:n,error:e,loading:r}=f(C);return{data:n,error:e,loading:r}}};const N=u(" UserName: ");E.render=function(n,e,r,a,u,s){return t(),o("div",null,[N,l("span",null,i(a.loading?"loading":a.data),1)])};export{W as a,P as b,w as c,D as d,b as e,E as s};
