import{b as e,M as t,i as r,G as n}from"./framework.f47b9a5e.js";import"./types.6ff06541.js";import{u as o}from"./index.ee32534f.js";import{d as a}from"./debounce.9def8c23.js";import{t as l}from"./throttle.ee997b4c.js";const i={formatResult:e=>e,requestMethod:function(e){let t,r;return"string"==typeof e?t=e:(t=e.url,r=e),fetch(t,r).then((e=>{if(e.ok)return e.json();throw new Error(e.statusText)}))},manual:!1,onSuccess:()=>{},onError:()=>{},onFinally:()=>{},defaultLoading:!1,loadingDelay:0,pollingInterval:0,pollingWhenHidden:!0,pollingSinceLastFinished:!0,defaultParams:[],debounceInterval:0,loadingWhenDebounceStart:!0,throttleInterval:0,initialData:void 0,throwOnError:!1},s=Symbol("useRequestConfig");function u(u,c={}){let f={};t()&&(f=r(s)??{});const m={...i,...f,...c},{requestMethod:d,defaultLoading:v,manual:h,throwOnError:g,onSuccess:p,onError:b,onFinally:I,formatResult:y,initialData:j,defaultParams:w,loadingDelay:S,debounceInterval:T,loadingWhenDebounceStart:P,throttleInterval:D,pollingInterval:E,pollingWhenHidden:F,pollingSinceLastFinished:L}=m;let R;R=["string","object"].includes(typeof u)?()=>d(u):(...e)=>new Promise(((t,r)=>{const n=u(...e);let o=n;if(!n.then){if(!["string","object"].includes(typeof n))throw new Error("If sevice is a function, it must return a String, Object or Promise");o=d(n)}o.then(t).catch(r)}));const W=e(v),q=e(j),x=e(),M=e(w),O=e(w);let k=0,H=!1;t()&&n((()=>{H=!0}));let C,G,V=e(!0);function z(...e){G&&clearTimeout(G),C&&clearTimeout(C),S?C=setTimeout((()=>{W.value=!0}),S):W.value=!0,k++;const t=k;M.value=e;const r=()=>H||t!==k;return R(...e).then((t=>{if(r())return;const n=y(t);return q.value=n,O.value=e,p(n,e),n})).catch((t=>{if(!r()&&(console.error(t),x.value=t,b(t,e),g))throw t})).finally((()=>{r()||(C&&clearTimeout(C),E&&L&&(G=F&&!V.value?setInterval((()=>{F&&!V.value||(clearInterval(G),z(...e))}),E):setTimeout((()=>{z(...e)}),E)),W.value=!1,I())}))}t()&&(V=o().isVisible);let A,B=z;if(T){const e=a(z,T);B=(...t)=>(P&&(W.value=!0),Promise.resolve(e(...t)))}if(D){const e=l(z,D);B=(...t)=>Promise.resolve(e(...t))}return E&&!L&&(B=(...e)=>(A&&clearInterval(A),A=setInterval((()=>{F&&!V.value||z(...e)}),E),z(...e))),h||B(...w),{loading:W,error:x,data:q,run:B,params:M,lastSuccessParams:O,cancel:()=>{A&&clearInterval(A),G&&clearTimeout(G),C&&clearTimeout(C),k++,W.value=!1},refresh:function(){return B(...M.value)}}}export{s as R,u};
